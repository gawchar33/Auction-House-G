<!doctype html>
<html ng-app="auctionApp">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Auction House</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
  <script src="app.js"></script>
  <script src="auth.js"></script>
</head>
<body ng-controller="HomeController">

  <!-- NAVBAR -->
  <nav class="site-nav" ng-controller="NavController" aria-label="Main navigation">
    <div class="nav-inner container">
      <a class="brand" href="index.html">
        <span class="brand-title">Auction <span class="brand-highlight">House</span></span>
      </a>

      <ul class="nav-menu">
        <li><a href="index.html">Home</a></li>
        <li><a href="category.html">Categories</a></li>
        <li><a href="product.html">Products</a></li>
        <li><a href="auction.html">Auctions</a></li>
        <li><a href="bidding.html">Bidding</a></li>
      </ul>

      <div class="nav-actions">
        <div class="nav-search">
          <input type="search" ng-model="q" placeholder="Search products..." aria-label="Search products">
        </div>

        <div class="action-links" ng-show="!isAuthenticated">
          <a class="link" href="login.html">Login</a>
          <a class="btn small" href="signup.html">Sign Up</a>
        </div>

        <div class="action-user" ng-show="isAuthenticated">
          <button class="avatar-btn" ng-click="toggleUserMenu($event)" aria-expanded="{{userMenu}}">
            <span class="avatar-badge" ng-bind="(user.first_name || user.username || user.name || 'U').substring(0,1) | uppercase"></span>
            <div class="user-meta">
              <span class="name">{{ user.first_name || user.username || user.name || 'User' }}</span>
              <small class="role" ng-if="user.role">{{ user.role }}</small>
            </div>
            <span class="caret">▾</span>
          </button>
          <ul class="avatar-menu" ng-class="{'open': userMenu}" ng-click="$event.stopPropagation()">
            <li><a href="#" ng-click="goProfile()">Profile</a></li>
            <li><a href="orders.html">My Bids</a></li>
            <li class="sep"><a href="#" ng-click="logout()">Logout</a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <main class="container main-wrap">
    <section class="featured" aria-label="Featured auctions">
      <!-- stylish section heading -->
      <div class="section-head">
        <h2 class="page-title">Featured Auctions</h2>
      </div>

      <!-- categories bar (populated from backend) -->
      <div class="categories-bar" ng-if="categories && categories.length">
        <div class="container categories-inner">
          <a class="cat-pill" ng-repeat="c in categories" href="category.html?name={{c.slug || c.name}}">
            {{ c.name }}
          </a>
        </div>
      </div>

      <div class="grid product-grid">
        <div class="products-row">
          <div class="card product-card">
            <img src="https://images.unsplash.com/photo-1516574187841-cb9cc2ca948b?auto=format&fit=crop&w=600&q=60" alt="Luxury Chronograph Watch" />
            <div class="card-body"><h3>Luxury Chronograph Watch</h3><div class="meta"><strong>Base</strong> $520 • <strong>Current</strong> $640</div></div>
          </div>

          <div class="card product-card" data-category="Shoes" data-stock="12" data-desc="Premium sports shoes with air cushioning, size 9, brand new.">
            <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=600&q=60" alt="Nike Air Max" />
            <div class="card-body"><h3>Nike Air Max</h3><div class="meta"><strong>Base</strong> $5,000.00 • <strong>Current</strong> $5,000.00</div></div>
          </div>

          <div class="card product-card">
            <img src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=600&q=60" alt="Dell Inspiron 15" />
            <div class="card-body"><h3>Dell Inspiron 15</h3><div class="meta"><strong>Base</strong> $35,000.00 • <strong>Current</strong> $35,000.00</div></div>
          </div>

          <div class="card product-card">
            <img src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?auto=format&fit=crop&w=600&q=60" alt="Flagship Smartphone" />
            <div class="card-body"><h3>Flagship Smartphone</h3><div class="meta"><strong>Base</strong> $699 • <strong>Current</strong> $850</div></div>
          </div>

          <div class="card product-card">
            <img src="https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&w=600&q=60" alt="Ultrabook Laptop" />
            <div class="card-body"><h3>Ultrabook Laptop</h3><div class="meta"><strong>Base</strong> $999 • <strong>Current</strong> $1150</div></div>
          </div>

          <div class="card product-card">
            <img src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=600&q=60" alt="Smart LED TV 55&quot;" />
            <div class="card-body"><h3>Smart LED TV 55"</h3><div class="meta"><strong>Base</strong> $450 • <strong>Current</strong> $580</div></div>
          </div>

          <div class="card product-card">
            <img src="https://images.unsplash.com/photo-1497215842964-222b430dc094?auto=format&fit=crop&w=600&q=60" alt="Contemporary Oil Painting" />
            <div class="card-body"><h3>Contemporary Oil Painting</h3><div class="meta"><strong>Base</strong> $240 • <strong>Current</strong> $300</div></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer container">
    <div id="site-year">© Auction House</div>
  </footer>

  <script>
    // minimal controller to power products and search (assumes module auctionApp exists in app.js)
    angular.module('auctionApp').controller('HomeController', ['$scope', '$window', '$http', function($scope, $window, $http){
      $scope.q = '';
      $scope.year = new Date().getFullYear();
      $scope.placeBid = function(p){
        $window.alert('Place bid on: ' + p.name);
      };

      // load categories from backend (expects 3 categories to be added there)
      $scope.categories = [];
      try {
        var endpoint = (window.BACKEND || 'http://127.0.0.1:8000') + '/category/';
        $http.get(endpoint, { withCredentials: true })
          .then(function(res){
            var d = res.data || {};
            // use array if returned directly, otherwise prefer paginated results
            $scope.categories = Array.isArray(d) ? d : (Array.isArray(d.results) ? d.results : []);
          })
          .catch(function(err){
            console.warn('[HOME] categories load failed', err && (err.status || err.message));
            $scope.categories = [];
          });
      } catch (e) { console.error('[HOME] categories init error', e); }

      // case-insensitive search filter using the q model
      $scope.searchFilter = function(item){
        if(!$scope.q) return true;
        var q = ($scope.q || '').toLowerCase();
        return (item.name||'').toLowerCase().indexOf(q) !== -1 || (item.cat||'').toLowerCase().indexOf(q) !== -1;
      };

      // expose year into footer (unchanged) - guard DOM access
      try {
        var sy = document.getElementById('site-year');
        if (sy) sy.textContent = '© ' + ($scope.year || (new Date()).getFullYear()) + ' Auction House';
      } catch (e) { console.warn('[HOME] site-year update failed', e); }

      // ensure NavController available (auth.js) will set isAuthenticated/user
    }]);
  </script>

</body>
</html>

